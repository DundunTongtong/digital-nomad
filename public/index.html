<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Digital Nomad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <h1>Digital Nomad Jobs</h1>

  <!-- ğŸ‘‡ ç­›é€‰å™¨ï¼ˆç¼ºäº†è¿™ä¸ªï¼Œä½ çš„ JS ä¸€å®šç‚¸ï¼‰ -->
  <div>
    <select id="regionFilter">
      <option value="all">å…¨éƒ¨åœ°åŒº</option>
      <option value="remote">Remote</option>
      <option value="asia">Asia</option>
      <option value="europe">Europe</option>
    </select>

    <select id="roleFilter">
      <option value="all">å…¨éƒ¨è§’è‰²</option>
      <option value="frontend">Frontend</option>
      <option value="backend">Backend</option>
    </select>
  </div>

  <!-- ğŸ‘‡ åˆ—è¡¨å®¹å™¨ï¼ˆç¼ºäº†è¿™ä¸ªï¼ŒrenderJobs ç›´æ¥å´©ï¼‰ -->
  <div id="jobList"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const jobList = document.getElementById('jobList')
      const regionFilter = document.getElementById('regionFilter')
      const roleFilter = document.getElementById('roleFilter')

      if (!jobList) {
        document.body.innerHTML += '<p>âŒ jobList ä¸å­˜åœ¨</p>'
        return
      }

      let jobs = []

      async function loadJobs() {
        try {
          const res = await fetch('/api/jobs')
          const data = await res.json()

          if (!Array.isArray(data)) {
            document.body.innerHTML += '<p>âŒ API è¿”å›ä¸æ˜¯æ•°ç»„</p>'
            console.error(data)
            return
          }

          jobs = data
          renderJobs()
        } catch (err) {
          document.body.innerHTML += '<p>âŒ åŠ è½½ jobs å¤±è´¥</p>'
          console.error(err)
        }
      }

      function renderJobs() {
        jobList.innerHTML = ''

        jobs
          .filter(j =>
            (regionFilter.value === 'all' || j.region === regionFilter.value) &&
            (roleFilter.value === 'all' || j.role === roleFilter.value)
          )
          .forEach(j => {
            const div = document.createElement('div')
            div.style.border = '1px solid #ccc'
            div.style.margin = '8px 0'
            div.style.padding = '8px'
            div.innerHTML = `
              <strong>${j.title}</strong> @ ${j.company}
              ${j.paid ? 'â­' : ''}
              <a href="${j.url}" target="_blank">æŸ¥çœ‹</a>
            `
            jobList.appendChild(div)
          })
      }

      regionFilter.onchange = roleFilter.onchange = renderJobs
      loadJobs()
    })
  </script>
</body>
</html>
